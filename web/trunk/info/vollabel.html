<?php
$vc_author = '$Author$';
$vc_date   = '$Date$';

include "inc_doctype.php";
?>
<html>
<head>
<title>rEFIt - Volume Labels</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<?php include "inc_head.php"; ?>
</head>
<body>
<?php include "inc_sidebar.php"; ?>
<div id="content">

<?php include "inc_trail.php"; ?>


<h1>Volume Labels</h1>

<p>
The built-in boot volume chooser displays the name of each volume below
its icon. This page describes how that volume name label is stored and
rendered.
</p>


<h2>General</h2>

<p>
Text rendering is quite complex. It is built into every operating system,
but when you have to operate in a pre-OS environment, you start cutting
corners.
Apple is doing exactly that for the boot volume chooser, and in fact has
done it for a long time on Open Firmware based PowerPC Macs as well.
</p>
<p>
The volume label is stored as a pre-rendered image file in a special format.
The file with the image has a well-known name and is located in the
"blessed folder", alongside the OS loader. That makes it easy for the
boot volume chooser to find and display the label.
</p>


<h2>File Format</h2>

<p>
The label is stored in a very simple custom file format. It has a 5 byte
header, followed by the uncompressed image data:
</p>
<table border="1" cellpadding="3" cellspacing="0">
<tr><th>Offset</th><th>Format</th><th>Content</th></tr>
<tr><td>0</td><td>8-bit integer</td>
  <td>Fixed value: 1</td></tr>
<tr><td>1</td><td>16-bit integer, big endian</td>
  <td>Width of the image in pixels</td></tr>
<tr><td>3</td><td>16-bit integer, big endian</td>
  <td>Height of the image in pixels, must be 12</td></tr>
<tr><td>5</td><td>Array of 8-bit integers</td>
  <td>Image data, 1 byte per pixel, in standard top-to-bottom, left-to-right order</td></tr>
</table>
<p>
The image data is interpreted as indices into a standard Macintosh 256 color palette.
However, the firmware in Intel Macs only supports the 16 indices that are pure grey.
All other values are mapped to white.
The 16 grey values, from white to black:
</p>
<pre>00, f6, f7, 2a, f8, f9, 55, fa, fb, 80, fc, fd, ab, fe, ff, d6</pre>


<h2>Tools for Labels</h2>

<p>
Mac OS X automatically creates labels for volumes that have Mac OS X installed.
(Note: It is not yet known whether this is done by the Installer, by the
"Startup Disk" preference pane, or both.)
These labels use only black and white, i.e. they don't render the text with
anti-aliasing. The reason for this is unknown.
</p>
<p>
The <tt>bless</tt> command line tool, which is used to set the blessed folder
and the OS loader file, has some options to set the label for the affected disk.
With the <tt>--label</tt> option, <tt>bless</tt> does the text rendering.
It tries to use anti-aliasing, but unfortunately doesn't create readable labels
in the process. Apparently it doesn't use the correct table for translating
greyscale values to palette indices.
</p>
<p>
The <tt>--labelfile</tt> option to <tt>bless</tt> lets you provide your own
pre-rendered image file. It must be in the format described above. In this case,
<tt>bless</tt> will simply copy the contents of that file into the hidden file
<tt>Volume Name Icon</tt>.
</p>
<p>
The rEFIt repository contains a tool that creates label image files from
greyscale images in a standard format like PNG.
The tool is called <tt>vollabel.py</tt> and can be found in the
<a href="http://svn.sourceforge.net/viewcvs.cgi/refit/trunk/images/vollabel/">images/vollabel</a>
directory of the repository. It is written in Python and requires that
<a href="http://www.pythonware.com/products/pil/">PIL</a> (Python Imaging Library)
is installed.
</p>


<?php include "inc_footer.php"; ?>
</div>
</body>
</html>
